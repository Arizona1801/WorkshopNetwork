<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jauge à secousses Pixel Art</title>
  <style>
    body {
      background: #222;
      padding: 20px;
      font-family: Arial, sans-serif;
    }

    h1 {
      color: white;
    }

    .jauge {
      width: 300px;
      height: 16px;
      background-color: #333;
      border: 1px solid #000;
      position: relative;
      overflow: hidden;
      image-rendering: pixelated;
    }

    .remplissage {
      height: 100%;
      width: 100%;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
      overflow: visible;
      border-radius: 0px 8px 8px 0px;
      transition: background-color 0.3s, width 0.3s;
    }

    .remplissage img.bout {
      position: absolute;
      top: 0;
      right: -2px;
      height: 100%;
      image-rendering: pixelated;
      pointer-events: none;
      z-index: 2;
    }

    /* Couleurs dynamiques */
    .remplissage.vert {
      background-color: #73CA45;
    }

    .remplissage.orange {
      background-color: #F4B942;
    }

    .remplissage.rouge {
      background-color: #D64541;
    }

    #startButton {
      padding: 10px 20px;
      background-color: #444;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }

    #startButton:hover {
      background-color: #555;
    }

    #text {
      color: white;
      margin-top: 10px;
    }

    #percentage {
      font-weight: bold;
      color: #fff;
    }
  </style>
</head>
<body>

  <h1>Remplis la jauge en secouant ton téléphone !</h1>

  <div class="jauge">
    <div class="remplissage vert" id="remplissage">
      <img src="barre.png" class="bout" />
    </div>
  </div>

  <p id="text">
    Secoue le téléphone pour vider la jauge.<br>
    Niveau : <span id="percentage">100%</span>
  </p>

  <button id="startButton">Activer les capteurs</button>

  <script>
    let lastShakeTime = 0;
    const remplissage = document.getElementById('remplissage');
    const pourcentageEl = document.getElementById('percentage');
    let currentWidth = 100;

    function updateGauge() {
      remplissage.style.width = currentWidth + '%';
      pourcentageEl.textContent = currentWidth + '%';

      // Mettre à jour la couleur
      remplissage.classList.remove('vert', 'orange', 'rouge');
      if (currentWidth > 60) {
        remplissage.classList.add('vert');
      } else if (currentWidth > 30) {
        remplissage.classList.add('orange');
      } else {
        remplissage.classList.add('rouge');
      }

      console.log(`Jauge à : ${currentWidth}%`);
    }

    function emptyGauge() {
      currentWidth = Math.max(0, currentWidth - 10);
      updateGauge();
    }

    function handleMotion(event) {
      const acc = event.accelerationIncludingGravity;
      const accTotal = Math.sqrt(acc.x ** 2 + acc.y ** 2 + acc.z ** 2);

      const now = Date.now();
      if (accTotal > 20 && now - lastShakeTime > 1000) {
        lastShakeTime = now;
        emptyGauge();
      }
    }

    document.getElementById('startButton').addEventListener('click', () => {
      if (typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission()
          .then(permissionState => {
            if (permissionState === 'granted') {
              window.addEventListener('devicemotion', handleMotion);
              alert("Capteurs activés ! Secoue le téléphone.");
            }
          })
          .catch(console.error);
      } else {
        window.addEventListener('devicemotion', handleMotion);
        alert("Capteurs activés ! Secoue le téléphone.");
      }
    });
  </script>

</body>
</html>
