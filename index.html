<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>title</title>    
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">Equipe sabotage</h1>
            <p class="subtitle">Secoue ton téléphone pour siphonner l’essence de la fusée</p>
        </div>
        
        <img class="secouepng" src="secoue.png" alt="rocket" />

        <div class="buttonContent">
            <div class="buttonBorder">
                <img class="borderSvg" src="border.svg" alt="">
                <button class="buttonBonus">Bonus</button>
            </div>
            <p class="subButton">Progression x2</p>
        </div>

        <p class="bottomText">Secoue!</p>

    </div>
    
    <script>
        let fill = 0; // Progression initiale
        let lastShake = 0; // Dernière secousse détectée
        const buttonBonus = document.querySelector('.buttonBonus');

        // Met à jour le remplissage du bouton
        function updateButtonFill() {
            buttonBonus.style.background = `linear-gradient(to top, var(--green) ${fill}%, #bbbec2 ${fill}%)`;
            if (fill >= 100) {
                buttonBonus.textContent = 'Cliquez !';
                buttonBonus.disabled = false; // Active le bouton
            } else {
                buttonBonus.textContent = 'Bonus';
                buttonBonus.disabled = true; // Désactive le bouton
            }
        }

        // Gère la détection des secousses
        function handleShake(event) {
            const acc = event.accelerationIncludingGravity;
            const totalAcc = Math.sqrt(acc.x ** 2 + acc.y ** 2 + acc.z ** 2);

            const now = Date.now();
            if (totalAcc > 20 && now - lastShake > 500) { // Seuil de secousse et délai
                lastShake = now;
                fill = Math.min(100, fill + 10); // Augmente la progression
                updateButtonFill();
            }
        }

        // Vide la jauge lorsque le bouton est cliqué
        buttonBonus.addEventListener('click', () => {
            if (fill >= 100) {
                fill = 0; // Réinitialise la jauge
                updateButtonFill();
                alert('Jauge vidée, bonus activé !');
            }
        });

        // Active les capteurs de mouvement
        window.addEventListener('load', () => {
            if (typeof DeviceMotionEvent?.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(result => {
                    if (result === 'granted') {
                        window.addEventListener('devicemotion', handleShake);
                    }
                }).catch(console.error);
            } else {
                window.addEventListener('devicemotion', handleShake);
            }
        });

        // Initialisation
        updateButtonFill();
    </script>
</body>
</html>
